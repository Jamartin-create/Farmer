# The Farmer Was Replaced — 种植/收获规则速查

本目录是 `The Farmer Was Replaced` 的脚本存档（入口：`main.py`）。本文档整理“种子/作物”相关规则，方便你在改 `do_plant.py` 或新增策略时对照实现。

## 文档目录（docs）

- `docs/pumpkin_strategy.md`：南瓜策略（小地图动态合并区版，含 \(m=n-\lfloor n/2\rfloor\)）
- `docs/farm_layout.md`：农场分区策略（南瓜 + 多作物混种）
- `docs/water_fertilizer_sunflower.md`：水 / 肥料 / 向日葵（规则与实战建议）
- `docs/companion_mixed_planting.md`：混合种植 / 伴生植物（Companion）— 提升产量的实现方案

## 胡萝卜（Carrot）

- **种植方式**：调用 `plant(Entities.Carrot)` 种植胡萝卜。
- **必须先耕地**：在种植胡萝卜之前必须先调用 `till()`。
  - 调用 `till()` 会将地块变为 `Grounds.Soil`。
  - **再次**调用 `till()` 会将地块变回 `Grounds.Grassland`（耕地是“开关”行为）。
- **耗材消耗**：种植胡萝卜会消耗 **干草** 与 **木材**（数量以游戏内胡萝卜专属页面为准）。

## 南瓜（Pumpkin）

- **生长地面**：与胡萝卜一样，需要在 **耕过的土地**（`Grounds.Soil`）上种植。
- **种植消耗**：种植南瓜需要消耗 **胡萝卜**。

### 合并为巨型南瓜

- 当一个**方形区域**内的南瓜都**完全成熟**时，会合并成 **1 个巨型南瓜**。
- 南瓜在完全成熟后有 **20%** 概率枯死，变为 **枯萎南瓜**：
  - 枯萎南瓜 **不会参与合并**，并且会**阻止**合并行为。
  - 若想让周围南瓜继续合并，需要**重新种植新的南瓜**替代枯萎南瓜。
- **枯萎南瓜收获**：
  - 枯萎南瓜收获不会掉落任何东西。
  - `can_harvest()` 在枯萎南瓜上**始终返回 `False`**。
  - 在枯萎南瓜位置上种植新植物会**自动移除**枯萎南瓜（无需单独“收获/清理”枯萎南瓜）。

### 巨型南瓜产量

巨型南瓜产量取决于合并的大小（\(n \times n\)）：

- \(1\times1\)：产出 \(1\times1\times1=1\) 个南瓜
- \(2\times2\)：产出 \(2\times2\times2=8\) 个
- \(3\times3\)：产出 \(27\) 个
- \(4\times4\)：产出 \(64\) 个
- \(5\times5\)：产出 \(125\) 个
- \(n\times n\)，当 \(n \ge 6\)：产出 \(n\times n\times 6\) 个

因此，**最佳南瓜合并大小是 \(6\times6\)**（单位面积产量最大）。注意：如果在方形区域每个地块都种南瓜，只要出现**任意一个**枯萎南瓜，就会阻止该区域的合并。

## 向日葵（Sunflower）

- **种植方式**：与胡萝卜/南瓜相同（同样需要耕地后种植；收获产出是“能量”而不是果实）。
- **收获产出**：收获一株成熟的向日葵会产出能量。
- **8 倍能量加成**：
  - 如果农场上至少有 **10** 株向日葵，并且你收获的是 **花瓣数量最多** 的那一株，就能获得 **8 倍** 能量。
  - 如果你收获一株向日葵时，农场上还有另一株花瓣更多的向日葵，那么你**接下来**收获的向日葵也只能获得普通数量的能量（没有 8 倍加成）。
- **测量花瓣**：
  - `measure()` 返回无人机下方那株向日葵的花瓣数量。
  - 花瓣数最少 **7**、最多 **15**。
  - 向日葵完全成熟之前就可以测量花瓣数量。
  - 可能存在多株向日葵花瓣数并列“最多”，收获任意一株都等价。

### 能量与加速

- 只要有能量，无人机会以 **两倍速度** 运行。
- 无人机每 **30 次行动**（移动、收获、种植……）消耗 **1 点能量**。
- 执行其他代码语句也会消耗能量，但比无人机行动少得多。
- 总体：在不考虑速度倍率的情况下，任何“用能量加速”的东西消耗的能量都与执行时间成正比。

## 树（Tree）

- **效率**：树比灌木获取木材效率更高；每棵树能提供 **5 份木材**。
- **可种植地面**：与灌木一样，可种在 **草地** 或 **耕过的土地** 上。
- **相邻减速**：树喜欢保持空间，相邻树会降低生长速度：
  - 每在其正北/正东/正西/正南的地块上种植一棵树，都会使其生长时间**翻倍**。
  - 如果每个地块都种树，生长时间将是原来的 \(2\times2\times2\times2 = 16\) 倍。

## 本仓库现有脚本提示

- `do_plant.py` 目前的实现是“按坐标规则收获后补种”（例如对 `x==y` / `x==0` / `x==1 or 2` 等分支做不同种植）。
- 如果你要把上面的规则落地到代码里，关键点通常是：**只在需要耕地的作物上确保 `Grounds.Soil`，并避免 `till()` 误触发二次切回草地**。
