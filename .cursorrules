# Cursor Rules（The Farmer Was Replaced：种植策略/约束）
#
# 目标：当修改/生成与种植相关的代码（尤其是 `do_plant.py`）时，必须遵守以下游戏规则，
# 避免出现“没耕地就种”“重复 till 导致反向切回草地”“南瓜枯萎处理错误”“向日葵 8 倍能量策略失效”等问题。

## 通用：耕地是开关
- `till()` 会切换地面类型：
  - 草地 `Grounds.Grassland` -> 土壤 `Grounds.Soil`
  - 再次 `till()` 会把 `Grounds.Soil` -> `Grounds.Grassland`
- 因此：对需要耕地的作物，代码必须采用“先检查地面类型，再决定是否 till”的方式，避免盲目连调用。

## 胡萝卜（Entities.Carrot）
- 种植：`plant(Entities.Carrot)`
- 约束：种植前必须保证当前地块为 `Grounds.Soil`（必要时先 `till()` 一次）。
- 资源：种植会消耗干草与木材（数量以游戏内页面为准）；不要在循环里无条件重复种植导致资源被快速耗尽。

## 南瓜（Entities.Pumpkin）
- 与胡萝卜相同：只能在 `Grounds.Soil` 上种植（必要时 `till()` 一次）。
- 种植南瓜会消耗胡萝卜（注意资源链）。

### 巨型南瓜合并与枯萎
- 只有当一个方形区域内的南瓜都“完全成熟”时才会合并成 1 个巨型南瓜。
- 南瓜完全成熟后有 20% 概率枯死，变为“枯萎南瓜”：
  - 枯萎南瓜不会参与合并，且会阻止合并。
  - `can_harvest()` 在枯萎南瓜上始终为 `False`：不要写“能收获就 harvest”的逻辑去处理枯萎南瓜。
  - 在枯萎南瓜格子上种植新植物会自动移除枯萎南瓜：处理枯萎时优先“直接补种”而不是尝试收获/清理。

### 合并规模建议
- 巨型南瓜产量：
  - n<=5：产量为 n*n*n
  - n>=6：产量为 n*n*6
- 策略：若目标是单位面积最大产量，优先设计 6x6 方形合并区。
- 注意：方形区域只要出现任意一个枯萎南瓜就会阻止合并；策略代码应快速发现并替换枯萎点位。

## 向日葵（Entities.Sunflower）
- 种植方式与胡萝卜/南瓜完全相同：必须保证 `Grounds.Soil` 后再 `plant(Entities.Sunflower)`。
- 收获产出能量；能量存在时无人机 2 倍速。
- 能量消耗：每 30 次行动消耗 1 点能量（其他代码语句也会消耗但更少）。

### 8 倍能量规则（高优先级）
- 若农场至少有 10 株向日葵，且收获的是“花瓣数量最多”的那株 => 8 倍能量。
- `measure()` 可测花瓣数（7~15），且成熟前也可测。
- 若收获时场上存在另一株花瓣更多的向日葵，则你接下来收获的向日葵只能获得普通能量：想拿 8 倍时，必须确保“收获目标 = 当前最大花瓣值（允许并列）”。

## 树（Entities.Tree）
- 每棵树提供 5 份木材；可种在草地或土壤上。
- 相邻减速：每个北/东/西/南方向的相邻树都会使生长时间翻倍；密集种植会非常慢（最坏 16 倍）。


